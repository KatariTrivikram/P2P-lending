<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Decentralized P2P Lending Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
    <style>
        body {
            background-color: #1c1c1c;
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px;
        }

        h1 {
            color: #00ffd5;
            margin-bottom: 20px;
        }

        button {
            background-color: #00ffd5;
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            margin: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        button:hover {
            background-color: #00c9aa;
        }

        input[type="text"],
        input[type="number"] {
            padding: 10px;
            margin: 10px;
            border: none;
            border-radius: 4px;
            width: 250px;
        }

        .section {
            border: 1px solid #00ffd5;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            width: 400px;
            background-color: #2e2e2e;
        }

        .section h2 {
            color: #ffaa00;
        }

        .status {
            margin-top: 20px;
            font-weight: bold;
        }
        .connected {
            color: #00ff90;
        }
        .disconnected {
            color: #ff5252;
        }
    </style>
</head>
<body>
    <h1>Decentralized Lending DApp</h1>
    <button onclick="connectWallet()">üîå Connect Wallet</button>
    <div class="status disconnected" id="walletAddress">Wallet not connected</div>

    <div class="section">
        <h2>Offer Loan</h2>
        <input type="number" id="offerAmount" placeholder="Loan Amount in ETH">
        <input type="number" id="offerCollateral" placeholder="Collateral in ETH">
        <button onclick="offerLoan()">üì§ Offer Loan</button>
    </div>

    <div class="section">
        <h2>Take Loan</h2>
        <input type="number" id="takeCollateral" placeholder="Collateral to Lock (ETH)">
        <button onclick="takeLoan()">üí∞ Take Loan</button>
    </div>

    <div class="section">
        <h2>Repay Loan</h2>
        <input type="number" id="repayAmount" placeholder="Repay Amount (ETH)">
        <button onclick="repayLoan()">üîÅ Repay Loan</button>
    </div>

    <script>
        let provider;
        let signer;
        let contract;

        const contractAddress = '0x7Df3692262B2b2bf185A0A7a529F6b33F0FCB669'; // Replace this
        const contractABI = [
            "function offerLoan(uint256 _collateral) external payable",
            "function takeLoan() external payable",
            "function repayLoan() external payable"
        ];

        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();
                    const address = await signer.getAddress();
                    document.getElementById('walletAddress').innerText = `Connected: ${address}`;
                    document.getElementById('walletAddress').className = 'status connected';
                    contract = new ethers.Contract(contractAddress, contractABI, signer);
                } catch (err) {
                    alert("Connection to wallet failed");
                    console.error(err);
                }
            } else {
                alert("MetaMask not found. Please install MetaMask!");
            }
        }

        async function offerLoan() {
            try {
                const amount = ethers.utils.parseEther(document.getElementById("offerAmount").value);
                const collateral = ethers.utils.parseEther(document.getElementById("offerCollateral").value);
                const tx = await contract.offerLoan(collateral, { value: amount });
                await tx.wait();
                alert("‚úÖ Loan Offered Successfully!");
            } catch (err) {
                alert("‚ùå Failed to offer loan");
                console.error(err);
            }
        }

        async function takeLoan() {
            try {
                const collateral = ethers.utils.parseEther(document.getElementById("takeCollateral").value);
                const tx = await contract.takeLoan({ value: collateral });
                await tx.wait();
                alert("‚úÖ Loan Taken Successfully!");
            } catch (err) {
                alert("‚ùå Failed to take loan");
                console.error(err);
            }
        }

        async function repayLoan() {
            try {
                const repayAmount = ethers.utils.parseEther(document.getElementById("repayAmount").value);
                const tx = await contract.repayLoan({ value: repayAmount });
                await tx.wait();
                alert("‚úÖ Loan Repaid Successfully!");
            } catch (err) {
                alert("‚ùå Failed to repay loan");
                console.error(err);
            }
        }
    </script>
</body>
</html>
